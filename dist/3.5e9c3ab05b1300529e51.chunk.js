webpackJsonp([3],{1016:function(t,e,n){var o=n(1017);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);n(32)("262a266a",o,!1)},1017:function(t,e,n){e=t.exports=n(31)(!1),e.push([t.i,"\n.margin-top-8 {\n  margin-top: 8px;\n}\n.margin-top-10 {\n  margin-top: 10px;\n}\n.margin-top-20 {\n  margin-top: 20px;\n}\n.margin-top-30 {\n  margin-top: 30px;\n}\n.margin-top-40 {\n  margin-top: 40px;\n}\n.margin-left-10 {\n  margin-left: 10px;\n}\n.margin-bottom-10 {\n  margin-bottom: 10px;\n}\n.margin-bottom-15 {\n  margin-bottom: 15px;\n}\n.margin-bottom-20 {\n  margin-bottom: 20px;\n}\n.margin-bottom-100 {\n  margin-bottom: 100px;\n}\n.margin-right-10 {\n  margin-right: 10px;\n}\n.padding-left-5 {\n  padding-left: 10px;\n}\n.padding-left-6 {\n  padding-left: 6px;\n}\n.padding-left-8 {\n  padding-left: 5px;\n}\n.padding-left-10 {\n  padding-left: 10px;\n}\n.padding-left-20 {\n  padding-left: 20px;\n}\n.padding-bottom-10 {\n  padding-bottom: 10px;\n}\n.height-100 {\n  height: 100%;\n}\n.height-120px {\n  height: 100px;\n}\n.height-150px {\n  height: 150px;\n}\n.height-200px {\n  height: 200px;\n}\n.height-460px {\n  height: 460px;\n}\n.height-492px {\n  height: 492px;\n}\n.line-gray {\n  height: 0;\n  border-bottom: 2px solid #dcdcdc;\n}\n.bottom-line {\n  border-bottom: 1px solid #e9eaec;\n}\n.notwrap {\n  word-break: keep-all;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n[v-cloak] {\n  display: none;\n}\n.promotion > .ivu-row > .ivu-card > .ivu-card-body {\n  background-color: #F0F0F0;\n}\n",""])},1018:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(630),i=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,function(){return o[t]})}(r);var a=n(1027),s=n.n(a),d=n(11),l=d(i.a,s.a,!1,null,null,null);l.options.__file="src/views/promotion/components/promotion-grid.vue",e.default=l.exports},1019:function(t,e,n){"use strict";function o(t){l||n(1020)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(631),r=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);var s=n(1022),d=n.n(s),l=!1,p=n(11),u=o,c=p(r.a,d.a,!1,u,null,null);c.options.__file="src/views/promotion/components/promotion-item.vue",e.default=c.exports},1020:function(t,e,n){var o=n(1021);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);n(32)("34973f30",o,!1)},1021:function(t,e,n){e=t.exports=n(31)(!1),e.push([t.i,"\n.margin-top-8 {\n  margin-top: 8px;\n}\n.margin-top-10 {\n  margin-top: 10px;\n}\n.margin-top-20 {\n  margin-top: 20px;\n}\n.margin-top-30 {\n  margin-top: 30px;\n}\n.margin-top-40 {\n  margin-top: 40px;\n}\n.margin-left-10 {\n  margin-left: 10px;\n}\n.margin-bottom-10 {\n  margin-bottom: 10px;\n}\n.margin-bottom-15 {\n  margin-bottom: 15px;\n}\n.margin-bottom-20 {\n  margin-bottom: 20px;\n}\n.margin-bottom-100 {\n  margin-bottom: 100px;\n}\n.margin-right-10 {\n  margin-right: 10px;\n}\n.padding-left-5 {\n  padding-left: 10px;\n}\n.padding-left-6 {\n  padding-left: 6px;\n}\n.padding-left-8 {\n  padding-left: 5px;\n}\n.padding-left-10 {\n  padding-left: 10px;\n}\n.padding-left-20 {\n  padding-left: 20px;\n}\n.padding-bottom-10 {\n  padding-bottom: 10px;\n}\n.height-100 {\n  height: 100%;\n}\n.height-120px {\n  height: 100px;\n}\n.height-150px {\n  height: 150px;\n}\n.height-200px {\n  height: 200px;\n}\n.height-460px {\n  height: 460px;\n}\n.height-492px {\n  height: 492px;\n}\n.line-gray {\n  height: 0;\n  border-bottom: 2px solid #dcdcdc;\n}\n.bottom-line {\n  border-bottom: 1px solid #e9eaec;\n}\n.notwrap {\n  word-break: keep-all;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n[v-cloak] {\n  display: none;\n}\n",""])},1022:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Card",{staticClass:"height-150px"},[n("Row",[n("i-col",{attrs:{span:"22"}},[n("Row",[n("h3",[t._v("主题: "+t._s(t.promotion.theme))])])],1),t._v(" "),n("i-col",{attrs:{span:"2"}},[n("a",{attrs:{disabled:t.saveLoading},on:{click:t.requestEdit}},[n("Icon",{attrs:{type:"compose",size:"18"}})],1),t._v(" "),n("a",{attrs:{disabled:t.saveLoading},on:{click:t.requestDelete}},[n("Icon",{attrs:{type:"trash-a",size:"18"}})],1)]),t._v(" "),n("Row",{staticClass:"margin-top-30"},[n("i-col",{attrs:{span:"18"}},[n("p",[t._v("类型: "+t._s(t.mode))])])],1),t._v(" "),n("Row",[n("i-col",{attrs:{span:"18"}},[n("p",[t._v("起始时间: "+t._s(t.promotion.begin))])])],1),t._v(" "),n("Row",[n("i-col",{attrs:{span:"18"}},[n("p",[t._v("终止时间: "+t._s(t.promotion.end))])]),t._v(" "),t.overtime?t._e():n("i-col",{attrs:{span:"6"}},[n("i-switch",{attrs:{disabled:t.saveLoading,size:"large"},on:{"on-change":t.save},model:{value:t.isrun,callback:function(e){t.isrun=e},expression:"isrun"}},[n("span",{attrs:{slot:"open"},slot:"open"},[t._v("进行")]),t._v(" "),n("span",{attrs:{slot:"close"},slot:"close"},[t._v("暂停")])])],1)],1)],1)],1)},i=[];o._withStripped=!0;var r={render:o,staticRenderFns:i};e.default=r},1023:function(t,e,n){"use strict";function o(t){l||n(1024)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(632),r=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);var s=n(1026),d=n.n(s),l=!1,p=n(11),u=o,c=p(r.a,d.a,!1,u,null,null);c.options.__file="src/views/promotion/components/create-promotion-item.vue",e.default=c.exports},1024:function(t,e,n){var o=n(1025);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);n(32)("6c2513ec",o,!1)},1025:function(t,e,n){e=t.exports=n(31)(!1),e.push([t.i,"\n.margin-top-8 {\n  margin-top: 8px;\n}\n.margin-top-10 {\n  margin-top: 10px;\n}\n.margin-top-20 {\n  margin-top: 20px;\n}\n.margin-top-30 {\n  margin-top: 30px;\n}\n.margin-top-40 {\n  margin-top: 40px;\n}\n.margin-left-10 {\n  margin-left: 10px;\n}\n.margin-bottom-10 {\n  margin-bottom: 10px;\n}\n.margin-bottom-15 {\n  margin-bottom: 15px;\n}\n.margin-bottom-20 {\n  margin-bottom: 20px;\n}\n.margin-bottom-100 {\n  margin-bottom: 100px;\n}\n.margin-right-10 {\n  margin-right: 10px;\n}\n.padding-left-5 {\n  padding-left: 10px;\n}\n.padding-left-6 {\n  padding-left: 6px;\n}\n.padding-left-8 {\n  padding-left: 5px;\n}\n.padding-left-10 {\n  padding-left: 10px;\n}\n.padding-left-20 {\n  padding-left: 20px;\n}\n.padding-bottom-10 {\n  padding-bottom: 10px;\n}\n.height-100 {\n  height: 100%;\n}\n.height-120px {\n  height: 100px;\n}\n.height-150px {\n  height: 150px;\n}\n.height-200px {\n  height: 200px;\n}\n.height-460px {\n  height: 460px;\n}\n.height-492px {\n  height: 492px;\n}\n.line-gray {\n  height: 0;\n  border-bottom: 2px solid #dcdcdc;\n}\n.bottom-line {\n  border-bottom: 1px solid #e9eaec;\n}\n.notwrap {\n  word-break: keep-all;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n[v-cloak] {\n  display: none;\n}\n.create-promotion-item {\n  border: 2px dashed #dddee1;\n  border-color: #e9eaec;\n}\n.create-promotion-item .title {\n  color: #9ea7b4;\n  font-size: 20px;\n  text-align: center;\n}\n.create-promotion-item:hover {\n  border-color: #e4e5e7;\n}\n",""])},1026:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Button",{staticClass:"height-150px create-promotion-item",attrs:{long:""},on:{click:t.onClick}},[n("Row",{attrs:{justify:"center",align:"middle"}},[n("i-col",{attrs:{span:"24"}},[n("p",{staticClass:"title"},[n("Icon",{attrs:{type:"plus",size:"20",color:"#9ea7b4"}}),t._v("\n                添加新任务\n            ")],1)])],1)],1)},i=[];o._withStripped=!0;var r={render:o,staticRenderFns:i};e.default=r},1027:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Row",{attrs:{gutter:24}},[t._l(t.promotionsList,function(e,o){return n("i-col",{key:o,staticClass:"margin-bottom-10",attrs:{sm:12,md:8}},[n("promotion-item",{attrs:{promotion:e},on:{"request-edit":t.requestEdit,"request-delete":t.requestDelete}})],1)}),t._v(" "),t.showCreateItem?n("i-col",{staticClass:"margin-bottom-10",attrs:{sm:12,md:8}},[n("create-promotion-item",{on:{"on-click":t.requestAdd}})],1):t._e()],2)},i=[];o._withStripped=!0;var r={render:o,staticRenderFns:i};e.default=r},1028:function(t,e,n){"use strict";function o(t){l||n(1029)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(633),r=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);var s=n(1031),d=n.n(s),l=!1,p=n(11),u=o,c=p(r.a,d.a,!1,u,null,null);c.options.__file="src/views/promotion/components/promotion-editor.vue",e.default=c.exports},1029:function(t,e,n){var o=n(1030);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);n(32)("ee869752",o,!1)},1030:function(t,e,n){e=t.exports=n(31)(!1),e.push([t.i,"\n.promotion-editor-rule {\n  margin-top: 15px;\n}\n.promotion-editor-rule-label {\n  padding: 0 !important;\n}\n.promotion-editor-date-time-range {\n  width: 100%;\n}\n",""])},1031:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Modal",{attrs:{"mask-closable":!1,width:"380"},model:{value:t.syncEditting,callback:function(e){t.syncEditting=e},expression:"syncEditting"}},[n("p",{attrs:{slot:"header"},slot:"header"},[n("Icon",{attrs:{type:"edit"}}),t._v(" "),n("span",[t._v("编辑活动")])],1),t._v(" "),n("Form",{ref:"promotionForm",attrs:{model:t.edittingPromotion,rules:t.ruleValidate,"label-width":80}},[n("FormItem",{attrs:{label:"活动主题",prop:"theme"}},[n("Input",{attrs:{placeholder:"输入...",disabled:t.saveLoading},model:{value:t.edittingPromotion.theme,callback:function(e){t.$set(t.edittingPromotion,"theme",e)},expression:"edittingPromotion.theme"}})],1),t._v(" "),n("FormItem",{attrs:{label:"活动时间",prop:"dateTimeRange"}},[n("DatePicker",{staticClass:"promotion-editor-date-time-range",attrs:{editable:!1,disabled:t.saveLoading,type:"datetimerange",placeholder:"请选择时间段",format:"yyyy-MM-dd HH:mm"},on:{"on-change":t.dateTimeRangeChanged},model:{value:t.edittingPromotion.dateTimeRange,callback:function(e){t.$set(t.edittingPromotion,"dateTimeRange",e)},expression:"edittingPromotion.dateTimeRange"}})],1),t._v(" "),n("FormItem",{attrs:{label:"活动类型"}},[n("Row",[n("i-col",{attrs:{span:"20"}},[n("RadioGroup",{on:{"on-change":t.updateRules},model:{value:t.edittingPromotion.mode,callback:function(e){t.$set(t.edittingPromotion,"mode",e)},expression:"edittingPromotion.mode"}},[n("Radio",{attrs:{label:1,disabled:t.saveLoading}},[t._v("满减")]),t._v(" "),n("Radio",{attrs:{label:2,disabled:t.saveLoading}},[t._v("满折")])],1)],1),t._v(" "),n("i-col",{attrs:{span:"4"}},[n("Button",{attrs:{type:"primary",shape:"circle",icon:"plus",disabled:t.saveLoading},on:{click:t.addRule}})],1)],1)],1),t._v(" "),n("FormItem",{attrs:{prop:"rules"}},t._l(t.edittingPromotion.rules,function(e,o){return n("FormItem",{key:o,staticClass:"promotion-editor-rule"},[n("Row",{attrs:{gutter:16}},[n("i-col",{staticClass:"promotion-editor-rule-label",attrs:{span:"1"}},[t._v("满")]),t._v(" "),n("i-col",{attrs:{span:"8"}},[n("InputNumber",{attrs:{placeholder:"输入...",disabled:t.saveLoading},model:{value:e.requirement,callback:function(n){t.$set(e,"requirement",n)},expression:"rule.requirement"}})],1),t._v(" "),n("i-col",{staticClass:"promotion-editor-rule-label",attrs:{span:"1"}},[t._v(t._s(t.rulesMiddleInfo))]),t._v(" "),n("i-col",{attrs:{span:"8"}},[1===t.edittingPromotion.mode?n("InputNumber",{attrs:{min:0,disabled:t.saveLoading,placeholder:"输入..."},model:{value:e.discount,callback:function(n){t.$set(e,"discount",n)},expression:"rule.discount"}}):t._e(),t._v(" "),2===t.edittingPromotion.mode?n("InputNumber",{attrs:{min:0,max:1,disabled:t.saveLoading,placeholder:"输入..."},model:{value:e.discount,callback:function(n){t.$set(e,"discount",n)},expression:"rule.discount"}}):t._e()],1),t._v(" "),n("i-col",{staticClass:"promotion-editor-rule-label",attrs:{span:"1"}},[t._v(t._s(t.rulesLastInfo))]),t._v(" "),n("i-col",{attrs:{span:"1",offset:"2"}},[n("a",{on:{click:function(e){t.removeRule(o)}}},[n("Icon",{attrs:{type:"close",color:"gray"}})],1)])],1)],1)}))],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"success",size:"large",long:"",loading:t.saveLoading},on:{click:t.save}},[t._v("保存")])],1)],1)},i=[];o._withStripped=!0;var r={render:o,staticRenderFns:i};e.default=r},1032:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"promotion"},[t.spinShow?n("Spin",{attrs:{fix:""}},[n("Icon",{staticClass:"demo-spin-icon-load",attrs:{type:"load-c",size:"18"}}),t._v(" "),n("div",[t._v("加载中...")])],1):t._e(),t._v(" "),n("Row",[n("Card",{attrs:{"dis-hover":""}},[n("p",{attrs:{slot:"title"},slot:"title"},[n("Icon",{attrs:{type:"checkmark",color:"green"}}),t._v("\n                进行中\n            ")],1),t._v(" "),n("promotion-grid",{attrs:{"promotions-list":t.validPromotionsList,"show-create-item":!0},on:{"request-edit":t.editPromotion,"request-add":t.addPromotion,"request-delete":t.deletePromotion}})],1)],1),t._v(" "),n("Row",{staticClass:"margin-top-10"},[n("Card",{attrs:{"dis-hover":""}},[n("p",{attrs:{slot:"title"},slot:"title"},[n("Icon",{attrs:{type:"close",color:"red"}}),t._v("\n                已过期 / 未开始\n            ")],1),t._v(" "),n("promotion-grid",{attrs:{"promotions-list":t.invalidPromotionsList,"show-create-item":!1},on:{"request-edit":t.editPromotion,"request-delete":t.deletePromotion}})],1)],1),t._v(" "),n("promotion-editor",{attrs:{editting:t.isEditting,promotion:t.edittingPromotion},on:{"on-editting-change":t.syncEditting}})],1)},i=[];o._withStripped=!0;var r={render:o,staticRenderFns:i};e.default=r},427:function(t,e,n){"use strict";function o(t){l||n(1016)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(629),r=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);var s=n(1032),d=n.n(s),l=!1,p=n(11),u=o,c=p(r.a,d.a,!1,u,null,null);c.options.__file="src/views/promotion/promotion.vue",e.default=c.exports},451:function(t,e,n){"use strict";e.__esModule=!0;var o=n(49),i=function(t){return t&&t.__esModule?t:{default:t}}(o);e.default=i.default||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}},629:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(21),r=o(i),a=n(22),s=o(a),d=n(451),l=o(d),p=n(1018),u=o(p),c=n(1028),m=o(c),g=n(104),f=n(18),h=o(f);e.default={name:"promotion_index",components:{PromotionGrid:u.default,PromotionEditor:m.default},data:function(){return{spinShow:!1,isEditting:!1,edittingPromotion:{}}},computed:(0,l.default)({},(0,g.mapState)({validPromotionsList:function(t){var e=new Date;return t.promotion.promotionsList.filter(function(t){var n=new Date(t.begin),o=new Date(t.end);return e>=n&&e<=o})},invalidPromotionsList:function(t){var e=new Date;return t.promotion.promotionsList.filter(function(t){var n=new Date(t.begin),o=new Date(t.end);return e<n||e>o})}})),created:function(){this.spinShow=!0,this.getPromotions()},methods:{getPromotions:function(){function t(){return e.apply(this,arguments)}var e=(0,s.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("promotion/getPromotionsList");case 2:this.spinShow=!1;case 3:case"end":return t.stop()}},t,this)}));return t}(),syncEditting:function(t){this.isEditting=t},addPromotion:function(){this.isEditting=!0,this.edittingPromotion={theme:"",begin:"",end:"",isend:0,rules:[{mode:1,requirement:0,discount:0}]}},editPromotion:function(t){this.isEditting=!0,this.edittingPromotion=h.default.deepCopy(t)},deletePromotion:function(){function t(t){return e.apply(this,arguments)}var e=(0,s.default)(r.default.mark(function t(e){var n=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.$Modal.confirm({title:"删除活动",content:"<p>确定删除该活动么？</p>",loading:!0,onOk:function(){function t(){return o.apply(this,arguments)}var o=(0,s.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.$store.dispatch("promotion/deletePromotion",e);case 3:n.$Message.success("成功删除"),n.$Modal.remove(),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),n.$Modal.remove(),n.$Message.error("删除失败");case 11:case"end":return t.stop()}},t,n,[[0,7]])}));return t}()});case 1:case"end":return t.stop()}},t,this)}));return t}()}}},630:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(1019),r=o(i),a=n(1023),s=o(a);e.default={components:{PromotionItem:r.default,CreatePromotionItem:s.default},props:{showCreateItem:Boolean,promotionsList:Array},methods:{requestEdit:function(t){this.$emit("request-edit",t)},requestDelete:function(t){this.$emit("request-delete",t)},requestAdd:function(){this.$emit("request-add")}}}},631:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(21),r=o(i),a=n(22),s=o(a),d=n(18),l=o(d);e.default={props:{promotion:Object},data:function(){return{saveLoading:!1}},computed:{mode:function(){return this.promotion.rules.length>0?1===this.promotion.rules[0].mode?"满减":"满折":"未知"},isrun:{get:function(){return 0===this.promotion.isend},set:function(t){this.promotion.isend=t?0:1}},overtime:function(){var t=new Date,e=new Date(this.promotion.begin),n=new Date(this.promotion.end);return t<e||t>n}},methods:{requestEdit:function(){this.$emit("request-edit",this.promotion)},requestDelete:function(){this.$emit("request-delete",this.promotion)},save:function(){function t(t){return e.apply(this,arguments)}var e=(0,s.default)(r.default.mark(function t(e){var n;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.saveLoading=!0,t.prev=1,n=l.default.deepCopy(this.promotion),t.next=5,this.$store.dispatch("promotion/updatePromotion",{promotion:n,deletedRules:[]});case 5:this.$Message.success(1===n.isend?"活动已暂停":"活动进行中"),this.syncEditting=!1,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),this.$Message.error("活动状态变更失败");case 12:this.saveLoading=!1;case 13:case"end":return t.stop()}},t,this,[[1,9]])}));return t}()}}},632:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={methods:{onClick:function(){this.$emit("on-click")}}}},633:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(21),r=o(i),a=n(22),s=o(a),d=n(18),l=o(d);e.default={props:{promotion:Object,editting:Boolean},data:function(){return{saveLoading:!1,syncEditting:this.editting,edittingPromotion:{},deletedRules:[],ruleValidate:{theme:[{type:"string",required:!0,message:"菜品名称不能为空",trigger:"blur"}],dateTimeRange:[{type:"array",len:2,required:!0,message:"请选择活动时间",trigger:"change"},{validator:function(t,e,n,o,i){var r=[];e[0]&&e[1]||r.push(new Error("请选择活动时间")),n(r)}}],rules:[{validator:function(t,e,n,o,i){var r=[];e.length<1&&r.push(new Error("至少要有一条优惠")),n(r)}},{validator:function(t,e,n,o,i){var r=[],a=/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/;e.forEach(function(t,e){a.test(t.requirement)||r.push(new Error("请检查金额是否符合规范 (小数点后最多 2 位)")),1===t.mode?a.test(String(t.discount))||r.push(new Error("请检查金额是否符合规范 (小数点后最多 2 位)")):(t.discount<0||t.discount>1)&&r.push(new Error("折扣范围只能为 0 ~ 1"))}),n(r)}}]}}},computed:{rulesMiddleInfo:function(){return 1===this.edittingPromotion.mode?"减":"打"},rulesLastInfo:function(){return 1===this.edittingPromotion.mode?"元":"折"}},watch:{promotion:function(t){this.deletedRules=[],this.edittingPromotion=t,this.edittingPromotion.dateTimeRange=[t.begin,t.end],this.edittingPromotion.rules.length>0?this.$set(this.edittingPromotion,"mode",this.edittingPromotion.rules[0].mode):this.$set(this.edittingPromotion,"mode",1)},editting:function(t){this.syncEditting=t},syncEditting:function(t){this.$emit("on-editting-change",t)}},methods:{dateTimeRangeChanged:function(t){this.edittingPromotion.begin=t[0],this.edittingPromotion.end=t[1]},updateRules:function(t){this.edittingPromotion.rules.forEach(function(e,n){e.mode=t})},addRule:function(){this.edittingPromotion.rules.push({requirement:0,discount:0,mode:this.edittingPromotion.mode})},removeRule:function(t){this.deletedRules=this.deletedRules.concat(this.edittingPromotion.rules.splice(t,1))},save:function(){function t(){return e.apply(this,arguments)}var e=(0,s.default)(r.default.mark(function t(){var e=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.saveLoading=!0,this.$refs.promotionForm.validate(function(){var t=(0,s.default)(r.default.mark(function t(n){var o;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=19;break}if(t.prev=1,o=l.default.deepCopy(e.edittingPromotion),delete o.dateTimeRange,delete o.mode,!o.id){t.next=10;break}return t.next=8,e.$store.dispatch("promotion/updatePromotion",{promotion:o,deletedRules:l.default.deepCopy(e.deletedRules)});case 8:t.next=12;break;case 10:return t.next=12,e.$store.dispatch("promotion/createPromotion",o);case 12:e.$Message.success("保存成功"),e.syncEditting=!1,t.next=19;break;case 16:t.prev=16,t.t0=t.catch(1),e.$Message.error("保存失败");case 19:e.saveLoading=!1;case 20:case"end":return t.stop()}},t,e,[[1,16]])}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,this)}));return t}()}}}});